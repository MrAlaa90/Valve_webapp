{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <h2>Valves List</h2>

    <!-- Search and Filter Form -->
    <form method="get" class="mb-4" id="filter-form">
        <div class="row">
            <div class="col-md-6">
                <input type="text" name="q" class="form-control" placeholder="Search by Tag, Name, Type, Location..."
                    value="{{ search_query }}">
            </div>
            <div class="col-md-3">
                <select name="factory" class="form-control" id="factory-select">
                    <option value="">All Factories</option>
                    {% for factory in factories %}
                    <option value="{{ factory.name|slugify }}">{{ factory.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <button type="submit" class="btn btn-primary w-100">Filter</button>
            </div>
        </div>
    </form>

    <table class="table table-striped">
        <thead class="table-primary text-white">
            <tr>
                <th>Tag Number</th>
                <th>Factory</th>
                <th>Type</th>
                <th>Location</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for valve in valves %}
            <tr>
                <td>{{ valve.tag_number }}</td>
                <td>
                    {% if valve.factory %}
                    <span class="badge bg-{{ valve.factory.get_color }}">{{ valve.factory.name }}</span>
                    {% else %}
                    <span class="text-muted">-</span>
                    {% endif %}
                </td>
                <td>{{ valve.valve_type.name }}</td>
                <td>{{ valve.location }}</td>
                <td>{{ valve.status.name }}</td>
                <td>
                    <a href="{% url 'valves:valve-detail-frontend' pk=valve.pk %}?{{ request.GET.urlencode }}"
                        class="btn btn-sm btn-info">Details</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5">No valves found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Pagination -->
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            {% if valves.has_previous %}
            <li class="page-item"><a class="page-link"
                    href="?page=1&amp;factory={{ selected_factory }}&amp;status={{ selected_status }}&amp;q={{ search_query }}">&laquo;
                    First</a></li>
            <li class="page-item"><a class="page-link"
                    href="?page={{ valves.previous_page_number }}&amp;factory={{ selected_factory }}&amp;status={{ selected_status }}&amp;q={{ search_query }}">Previous</a>
            </li>
            {% endif %}

            <li class="page-item disabled"><a class="page-link" href="#">Page {{ valves.number }} of {{
                    valves.paginator.num_pages }}</a></li>

            {% if valves.has_next %}
            <li class="page-item"><a class="page-link"
                    href="?page={{ valves.next_page_number }}&amp;factory={{ selected_factory }}&amp;status={{ selected_status }}&amp;q={{ search_query }}">Next</a>
            </li>
            <li class="page-item"><a class="page-link"
                    href="?page={{ valves.paginator.num_pages }}&amp;factory={{ selected_factory }}&amp;status={{ selected_status }}&amp;q={{ search_query }}">Last
                    &raquo;</a></li>
            {% endif %}
        </ul>
    </nav>
</div>

{% endblock %}