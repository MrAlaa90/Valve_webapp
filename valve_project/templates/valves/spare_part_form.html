{% extends "base.html" %}
{% load static %}

{% block title %}{% if is_update %}تعديل{% else %}إضافة{% endif %} قطعة غيار{% endblock %}

{% block content %}

<div class="row justify-content-center mt-5">
<div class="col-md-7 col-lg-6">
<div class="card shadow-lg border-0 rounded-3">
<div class="card-header bg-primary text-white text-center py-3">
<h4 class="mb-0">
<i class="fas fa-tools me-2"></i>
{% if is_update %}تعديل بيانات قطعة الغيار{% else %}إضافة قطعة غيار جديدة{% endif %}
</h4>
</div>
<div class="card-body p-4">

            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} text-center">{{ message }}</div>
                {% endfor %}
            {% endif %}

            <form method="post">
                {% csrf_token %}

                {# حقل كود القطعة #}
                <div class="mb-3">
                    <label for="id_part_code" class="form-label fw-bold">كود القطعة المعياري:</label>
                    {# نفترض أن الـ View يمرر البيانات في متغير part #}
                    <input type="text" class="form-control" id="id_part_code" name="part_code" 
                           value="{{ part.part_code|default_if_none:'' }}" required 
                           placeholder="مثل: GASKET-01 أو SEAL-M12">
                    <div class="form-text">يجب أن يتطابق مع أحد الأكواد المسجلة.</div>
                </div>
                
                {# حقل اسم القطعة #}
                <div class="mb-3">
                    <label for="id_name" class="form-label fw-bold">اسم القطعة (وصف مختصر):</label>
                    <input type="text" class="form-control" id="id_name" name="name" 
                           value="{{ part.name|default_if_none:'' }}" required 
                           placeholder="مثل: طوق مانع تسرب علوي">
                </div>

                {# حقل المخزون #}
                <div class="mb-3">
                    <label for="id_quantity" class="form-label fw-bold">الكمية المتوفرة في المخزون:</label>
                    <input type="number" class="form-control" id="id_quantity" name="quantity" 
                           value="{{ part.quantity|default_if_none:'0' }}" required min="0">
                </div>

                {# حقل السعر #}
                <div class="mb-3">
                    <label for="id_price" class="form-label fw-bold">سعر القطعة (بالريال):</label>
                    <input type="number" class="form-control" id="id_price" name="price" 
                           value="{{ part.price|default_if_none:'' }}" step="0.01" placeholder="أدخل السعر">
                </div>

                {# حقل البلف المرتبط (اختياري) #}
                <div class="mb-3">
                    <label for="id_associated_valve" class="form-label fw-bold">البلف المرتبط (اختياري):</label>
                    {# هنا يجب استخدام قائمة من البلوف المتاحة - نفترض تمريرها كـ choices #}
                    <select class="form-select" id="id_associated_valve" name="associated_valve">
                        <option value="">-- اختر بلفاً (إذا كانت قطعة غيار خاصة) --</option>
                        {# مثال افتراضي: يجب استبداله بـ for loop على choices #}
                        {% comment %}
                        {% for valve_choice in valve_choices %}
                            <option value="{{ valve_choice.id }}" 
                                {% if part.associated_valve.id == valve_choice.id %}selected{% endif %}>
                                {{ valve_choice.name }} - {{ valve_choice.tag_number }}
                            </option>
                        {% endfor %}
                        {% endcomment %}
                    </select>
                </div>

                <div class="d-grid gap-2 mt-4">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-save me-2"></i>
                        {% if is_update %}حفظ التعديلات{% else %}إضافة القطعة{% endif %}
                    </button>
                    <a href="{% url 'valves:spare-part-list-frontend' %}" class="btn btn-secondary mt-2">
                        إلغاء والعودة للقائمة
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

</div>
{% endblock content %}